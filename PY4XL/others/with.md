# 上下文管理器和 `with` 语句

首先，Python 中的 `with` 语句和 VBA 中的 `With` 语句没有任何关系：在 VBA 中，`With` 语句被用于在同一对象上执行一系列语句；而 Python 中的 `with` 语句被用于管理文件或数据连接之类的资源。如果你想加载最新的销售数据以便对其进行分析，就必须打开一个文件或者建立一个数据库连接。在数据读取完成后，最好尽快关闭文件或者数据库连接。否则，你可能会无法打开其他文件或者建立新的数据库连接——因为文件句柄和数据库连接都是有限资源。手动打开和关闭文本文件的代码如下所示（w 表示将文件以 write 模式打开，如果文件已存在则会替换现有文件）：

```python
f = open("output.txt", "w")
f.write("Some text")
f.close()
```

执行这段代码会在笔记本的工作目录中创建一个叫作 output.txt 的文件，并将 “Some text” 写入文件。要读取一个文件，你需要使用 r 模式而不是 w 模式；要在文件末尾追加内容，则需要使用 a 模式。由于文件还可以被其他程序操作，因此这些操作可能会失败。你可以通过 `try/except` 机制来处理这类问题。由于文件的打开和关闭是一种相当常见的操作，因此 Python 提供了 `with` 语句来简化这类代码：

```python
with open("output.txt", "w") as f:
    f.write("Some text")
```

当代码的执行过程离开 `with` 语句的主体时，无论是否发生异常，文件都会被自动关闭，从而可以保证资源总是能够得到清理。支持 `with` 语句的对象被称作**上下文管理器**（context manager），`ExcelFile` 对象和 `ExcelWriter` 对象，数据库连接对象都是上下文管理器。
