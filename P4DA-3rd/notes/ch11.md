# 时间序列

在多个时间点观测或测量的数据形成了时间序列。许多时间序列是固定频率的，也就是说数据是根据相同的规则定期出现的，例如每 15 秒、每 5 分钟或每月 1 次。时间序列也可以是不规则的，没有固定的时间单位或单位间的偏移量。如何标记和引用时间序列数据取决于应用程序，可能有以下其中一项：

- 时间戳，具体的时刻。
- 固定的时间区间，例如2007的1月或整个2010年。
- 时间间隔，由开始和结束时间戳表示。时间区间可以被认为是间隔的特殊情况。
- 实验时间或消耗时间。每个时间戳是相对于特定开始时间的时间的量度（例如，自从被放置在烤箱中每秒烘烤的饼干的直径）。

这里主要关注前三类中的时间序列，尽管许多技术可以应用于实验时间序列，其中索引可以是整数，也可以是从实验开始时的消耗时间的浮点数。最简单和最广泛使用的时间序列是那些由时间戳索引的。

pandas 也支持基于时间间隔的索引，这是一种表示实验时间或消耗时间的有效方式。这里不涉及时间差索引，请参考 [pandas documentation](https://pandas.pydata.org/)。

pandas 提供了许多内置的时间序列工具和算法。可以高效地处理大型时间序列，并对不规则和固定频率时间序列进行切片、聚合和重新采样。其中一些工具对于金融和经济应用程序很有用，当然也可以使用它们来分析服务器日志数据。

## 日期和时间数据的类型及工具

Python 标准库包含了日期和时间数据的类型，也包括日历相关的功能。`datetime`、`time`和 `calendar` 模块是开始处理时间数据的主要内容。`datetime.datetime` 类型，或简写为 `datetime`，是广泛使用的数据类型。

```python
>>> from datetime import datetime
>>> 
>>> now = datetime.now()
>>> now
datetime.datetime(2024, 4, 7, 1, 14, 3, 590373)
>>> now.year, now.month, now.day
(2024, 4, 7)
>>> 
```

`datetime` 以毫秒的形式存储日期和时间。`timedelta` 表示两个 `datetime` 对象的时间差。

可以为一个 `datetime` 对象加上（或减去）一个或多个 `timedelta`，这样会生成一个新的偏移对象。

|类型|说明|
|---|---|
|`date`|以公历形式存储日历日期（年、月、日）|
|`time`|将时间存储为时、分、秒和微妙|
|`datetime`|存储日期和时间|
|`timedelta`|两个 `datetime` 值之间的差（日、秒、微妙）|
|`tzinfo`|存储时区信息的基础类型|

### 字符串与 `datetime` 互相转换

使用 `str` 方法或 `strftime` 方法并传递一个指定格式，对 `datetime` 对象和 pandas 的 `Timestamp` 对象进行格式化：

|类型| 描述                                                  |
|---|---|
|`%Y` | 四位数年份                                               |
|`%y` | 两位数年份                                               |
|`%m` | 两位数月份 [01, 12]                                      |
|`%d` | 两位数的日期 [01, 31]                                     |
|`%H` | 小时（24 小时制）[00, 23]                                  |
|`%I` | 小时（12 小时制）[01, 12]                                  |
|`%M` | 两位数分钟 [00, 59]                                      |
|`%S` | 秒 [00, 61]（秒 60, 61 代表闰秒）                      |
|`%f` | 微秒为整数，用零填充（从 000000 到 999999）                       |
|`%j` | 一年中的第几天，以零填充的整数（从 001 到 336）                        |
|`%w` | 整数形式的工作日 [0（星期日）, 6]                                |
|`%u` | 工作日为从 1 开始的整数，其中 1 表示星期一                            |
|`%U` | 一年中的周数 [00, 53]；星期日被视为一周的第一天，一年中第一个星期日之前的日子是“第 0 周” |
|`%W` | 一年中的周数 [00, 53]；星期一被视为一周的第一天，一年中第一个星期一之前的日子是“第 0 周” |
|`%z` | UTC 时区偏移量为+HHMM或-HHMM；如果没有时区则为空                     |
|`%Z` | 时区名称为字符串，如果没有时区则为空字符串                               |
|`%F` | \%Y-\%m-\%d（例如，2012-4-18）的快捷方式                      |
|`%D` | \%m/\%d/\%y（例如，04/18/12）的快捷方式|

可以使用 `datetime.srtptime` 和这些格式代码（但不能使用某些编码，比如 `%F`），将字符串转换日期：

`datetime.strptime` 是通过已知格式来解析日期的。

pandas 通常面向处理日期数组，无论是用作轴索引还是 DataFrame 中的列。`pandas.to_datetime` 方法解析许多不同类型的日期表示形式。可以快速解析 ISO 8601 等标准日期格式：

`to_datetime` 方法还可以处理那些被认为是缺失值的值（None、空字符串等），`NaT`（Not a time）是 pandas 中时间戳数据的是null值。

datetime对象还拥有许多其他国家或语言系统的本地化格式选项。例如，德语或法语的月份名称会和英语系统有所不同。

|类型  | 描述                                                |
|---|---|
|`%a` | 工作日缩写名称                                           |
|`%A` | 完整工作日名称                                           |
|`%b` | 月份名称缩写                                            |
|`%B` | 完整的月份名称                                           |
|`%c` | 完整日期和时间（例如“2012 年 5 月 1 日星期二 04:20:57 PM”）        |
|`%p` | AM 或 PM 的区域设置等效项                                  |
|`%x` | 适合区域设置的格式化日期（例如，在美国，2012 年 5 月 1 日生成“05/01/2012”） |
|`%X` | 适合区域设置的时间（例如“04:24:12 PM”）|

## 时间序列基础知识

pandas 中的基础时间序列种类是由时间戳索引的 Series，时间戳通常以 Python 字符串或 `datetime` 对象表示：

在底层，这些 `datetime` 对象被放入 `DatetimeIndex` 中：

和其他 Series 一样，不同索引的时间序列之间的算术运算按日期自动对齐：

pandas 使用 NumPy 的 `datetime64` 数据类型以纳秒精度存储时间戳

`DatetimeIndex` 中的标量值是 pandas 的 `Timestamp` 对象

`pandas.Timestamp` 可以替换大多数使用 `datetime` 对象的地方。然而，反之则不然，因为 `pandas.Timestamp` 可以存储纳秒精度的数据，而 datetime 最多只能存储微秒。此外，`pandas.Timestamp` 可以存储频率信息（如果有）并了解如何进行时区转换和其他类型的操作。

### 索引、选择、子集构造

当你基于标签进行索引和选择时，时间序列的行为和其他的 Series 类似

为了方便，你还可以传递一个能解释为日期的字符串

对一个长的时间序列，只需传递年或年月来轻松地选择数据的切片

`datetime` 对象也可以进行切片

因为大部分的时间序列数据是按时间顺序排序的，你可以使用不包含在时间序列中的时间戳进行切片，以执行范围查询

和之前一样，你可以传递一个字符串的日期、`datetime` 对象或者 `Timestamp`。请记住通过这种方式的切片产生了原时间序列的视图，类似于 NumPy 的数组。这意味着没有数据被复制，并且在切片上的修改会反映在原始数据上。

有一个等价实例方法 `truncate`，它可以截取两个日期之间的 Series

这些操作也都适用于 DataFrame，并在其行上进行索引

### 带有重复索引的时间序列

通过检查索引的 `is_unique` 属性，就可以知道索引是不是唯一的：

对这样的 Series 进行索引，结果是标量值还是 Series 切片取决于是否有时间戳是重复的

假设你想要对含有非唯一时间戳的数据进行聚合。一种方式就是使用 `groupby` 并传递 `level=0`（存在的唯一层级）：

## 日期的范围、频率以及移位

pandas 的通用时间序列是不规则的，即时间序列的频率不是固定的。对于很多应用来说，这足够了。然而，经常有需要处理固定频率的场景，例如每日的、每月的或每 15 分钟，这意味着我们甚至需要在必要的时候向时间序列中引入缺失值。幸运的是，pandas 拥有一整套标准的时间序列频率和工具用于重新采样、推断频率以及生成固定频率的数据范围。例如，你可以通过调用 `resample` 方法将样本时间序列转换为固定的每日频率数据：

### 生成日期范围

`pandas.date_range` 是用于根据特定频率生成指定长度的 `DatetimeIndex`：
